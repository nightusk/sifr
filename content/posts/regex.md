---
title: "正規表現(Regular Expression)"
date: 2021-06-09T20:57:44+09:00
draft: false
---

# 正規表現とは？

文字列の集合(set)を表す。

ん？意味が分からない。検索で使っているのをよく見かけるんだけど？

そう。検索で使うときには、条件に指定した文字列の集合に含まれる文字列を返している。
この他に正規表現が使われるシーンとしては、入力チェックがある。入力された文字列がチェック用の文字列集合に含まれていなければエラーとする、というものだ。
多分何のことを言っているのかわからないと思うが、今はそれでいい。下の節で詳しく見ていこう。

# 最小の正規表現

最小の集合といえば何だろう？そう空集合(empty set:Φ)だ。では、正規表現における空集合は何だろう？何もない文字列、つまり文字数0の
```
```
である。当然、検索条件に何も指定しないことになるので、検索結果は0件だろう。

# その次に小さな文字列の集合

集合の要素(element)がただ１つとなる正規表現を考えてみよう。例えば、"R"だけを要素とする正規表現ならば
```
R
```
となる。
同様に"XYZ"だけを要素とするなら
```
XYZ
```
となる。
つまり、一度に１つの条件でしか検索できない普通の検索と同じである。

# ２つの要素をもつ集合

"|"で区切ると、前後の２要素をもつ集合ができる。例えば
```
abc|xyz
```
なら"abc"と"xyz"の２要素をもつ集合となる。
プログラミングの経験があれば、OR演算子と同じ記号を使用していることに気付くでしょう。

# 複数の要素をもつ**文字**の集合

ここからようやく正規表現らしい記号が登場する。まずは```[]```(bracket)から。
[]で囲まれた文字は、その文字を要素とする文字数1の文字の集合となる。例えば
```
[asd]
```
であれば、"a"と"s"と"d"を要素とする3要素の文字集合となる。この条件で検索すれば"a"か"s"か"d"の文字が検索結果となる。
アルファベットの大文字小文字、合わせて52文字を要素とするには？
愚直に
```
[abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRTSUVWXYZ]
```
としてもよいが、範囲を表す文字"-"を試用することでより簡潔に書くことができる。
```
[a-zA-Z]
```
これら２つの正規表現はまったく同じ集合である。

# 繰り返す

"foo"と"fooo"と"foooo"を要素とする集合を作りたいと仮定しましょう。(どんなとき？"foo"と"fooo"と"foooo"を検索して、すべて"foo"に置き換えることを想像しましょう。)
|記号を使用して
```
foo|fooo|foooo
```
とすれば、実現できそうですが、きっとfoooooやfooooooも検索したくなります。そのたびに無限に増やしていくのでしょうか。
もっとよい方法があります。
```
fo{2,}
```
こうすればfooだろうとfoooooooooooooooooだろうと検索できます。

新しい記号が出てきました。`{}`(curly bracket)は直前の文字を繰り返すために使います。
使い方は`o{1,3}`のようにし、これは「oが1回以上、3回以下繰り返す文字列」の集合となります。
{}の中の数は省略することができ、その場合、{3}ならちょうど３回繰り返し、{3,}なら３回以上の繰り返し、{,3}なら３回以下の繰り返しになります。

# 繰り返したいのは文字列なんだけど

前の節で文字を繰り返す集合を学びました。でも繰り返したいのは文字列だということもあるかもしれません。(braとbrabraとbrabrabraのように)

前の節と同じようにやってみましょうか
```
bra{1,}
```
braが1回以上繰り返される文字列の集合になってほしいところですが、残念ながら、この正規表現ではbrabrabraは要素とならず、代わりにbraaaaaaaaaaaaaが要素になります。
つまり、{}の直前のaだけが繰り返されるのです。

braを繰り返したければ、()(paren)で囲みます。
```
(bra){1,}
```
これでbraもbrabraもbrabrabraも要素になります。ちょうど数式の中で優先順位を明らかにするために()で囲むのと同じです。

同じように|の前後でも()が使えます。例えば、center(中心)はイギリスではcent**re**とつづるようですが、
```
cent(er|re)
```
とすればどちらも要素となり検索できます。

# その他の正規表現

実のところ、ここまで見てきたことで正規表現のほとんどすべてである。
だから
```
()[]{}|
```
さえわかれば、正規表現を理解した、と言っても過言ではない。
(少し足りないところはあるが)

このほかにもいろいろな記法はあるが、それらは上で説明したことを、もっと楽に表すための手段でしかないし、覚えられなかったとしても上の基本的なやり方で代用できる。

よく使うものだけ例で挙げておこう

| 記法 | 別の記法 | 意味 |
| ---- | ------- | ----|
| \d   | [0-9]   | 数字 |
| \w   | [a-zA-Z_0-9] | アルファベットか数字かアンダーバー(C言語の変数名や関数名に使用できる文字) |
| \s   | [ \t\r\n] | スペース・タブ・改行などの空白文字
| .    |         | 任意の(any)1文字 |
| ?    | {0,1}   | 直前のパターンが０回か１回現れる |
| *    | {0,}    | 直前のパターンが０回以上繰り返す |
| +    | {1,}   | 直前のパターンが１回以上繰り返す |